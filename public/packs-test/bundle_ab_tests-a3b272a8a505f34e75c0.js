(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[7],{"/0Qq":function(e,t,a){(function(e){function t(e){return(t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,a){return!a||"object"!==t(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsContentEmpty=function(t){function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),n(this,s(i).apply(this,arguments))}var o,l,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(i,t),o=i,(l=[{key:"render",value:function(){return e.createElement("div",{className:"designed-layout"},e.createElement("div",{className:"designed-layout-section is-center"},e.createElement("p",{className:"is-zero-margin is-middle-font-size"},"Unable to create new A/B test without a Campaign and Content context. Please visit Editor of the Campaign you would like to set up an A/B test at and click \u201dCreate A/B Test\u201d button at\xa0the\xa0desired\xa0Content.")),e.createElement("div",{className:"designed-layout-footer is-gray is-center"},e.createElement("a",{className:"base-btn is-success is-big is-static-height",href:Routes.site_campaigns_path(Site)},"Visit Campaigns")))}}])&&a(o.prototype,l),c&&a(o,c),i}(e.Component)}).call(this,a("q1tI"))},"6OeU":function(e,t,a){"use strict";(function(e){var t=a("fRW6"),n=a("GaHK");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var a=[],n=!0,s=!1,r=void 0;try{for(var i,o=e[Symbol.iterator]();!(n=(i=o.next()).done)&&(a.push(i.value),!t||a.length!==t);n=!0);}catch(l){s=!0,r=l}finally{try{n||null==o.return||o.return()}finally{if(s)throw r}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function l(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsContent=function(a){function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=u(this,p(s).call(this,e))).formatStatuses=function(){return _.reduce(t.props.statuses,(function(e,t,a){return t&&e.push(a),e}),[])},t.filterCampaigns=function(){var e=t.props,a=e.localeEntry,n=e.campaignsByLocaleKey,s=e.campaigns,r=e.statuses,i=e.query,o=e.matchesSplitTestId,l=t.formatStatuses(r),c={attached:[],eligible:[],ineligible:[]};return s.forEach((function(e){var t,s,r=n[e.id];r&&(t=r.attached,s=(!r.split_test_id||o(r.split_test_id))&&r.trait===a.trait&&_.isEqual(r.enum_values.sort(),a.enum_values.sort()));var u=["".concat(e.id),e.name,e.status],p=_.filter(u,(function(e){return _.includes(e.toLowerCase(),i)}));i&&!p.length||(!_.includes(l,e.status)&&l.length||c[t?"attached":s?"eligible":"ineligible"].push(e))})),c},t.collapseStatusesChange=function(e){var a=_.merge({},t.state.collapseStatuses,l({},e,!t.state.collapseStatuses[e]));t.setState({collapseStatuses:a})},t.togglePreview=function(e){if(!t.canBePreviewable())return e.preventDefault();t.props.togglePreview(e)},t.canBePreviewable=function(){return!t.props.ABTestData.id||t.props.ABTestData.previewable},t.state={collapseStatuses:{attachedExpanded:!1,eligibleExpanded:!1,ineligibleExpanded:!1}},t}var d,f,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(s,a),d=s,(f=[{key:"render",value:function(){var a=this.props,s=a.ABTestData,c=a.localeEntry,u=a.campaignsByLocaleKey,p=a.abTestName,m=a.handleAddVariant,d=a.handleShowAbTestPreviewVariant,f=a.handleRemoveVariant,h=a.handleChangeMessage,g=a.handleChangeRatio,b=a.addVariantDisabled,y=a.deleteVariantDisabled,v=a.changeNameHandler,E=a.abTestVariants,w=a.localizationTrait,S=a.changeConversionMetric,C=a.abTestMetricId,T=a.localizationEnumValues,A=a.assetUploader,N=a.toggleAssetUploader,O=a.handleAssetsUploaderSelect,P=a.toggleAssetUploaderHandler,B=a.abTestSaveChanges,D=a.abTestDeleteModal,j=a.mode,k=a.toggleCampaign,V=a.toggleAllCampaigns,I=a.allCampaignsSelected,L=a.saveAbTestChangesDisabled,U=a.campaigns,q=a.liquidInterpolationKeys,x=a.liquidInterpolations,R=a.liquidInterpolationsFetched,K=a.errors,W=a.viewSetupLabel,M=a.referrerUrl,F=a.abTestVariantChangedWithImpression,z=a.statuses,H=a.applyCampaignFilter,G=a.takeAttachedLocales,Q=a.query,$=a.viewNames,Y=a.abTestVariantChosen,X=a.previewMode,J=a.togglePreview,Z=a.viewSetup,ee=_.reduce(u,(function(e,t){return t.attached||e}),!1),te=this.filterCampaigns(),ae=E.filter((function(e){return!e.deleted})),ne=_.reduce(E,(function(e,t){return e+t.distribution_rate}),0),se=_.reduce(E,(function(e,t,a){return e[a]=t.value,e}),{}),re=this.canBePreviewable(),ie=[];E.forEach((function(t,a){var n=T?T.slice():null;ie.push(e.createElement(Widget.AbTestsContentRow,o({localeEntry:c,assetUploader:A,position:UI.ALPHABET.charAt(a).toUpperCase(),percentage:"".concat(_.round(+t.distribution_rate/ne*100,2),"%"),handleShowAbTestPreviewVariant:d,handleRemoveVariant:f,handleChangeMessage:h,handleChangeRatio:g,deleteVariantDisabled:y,localizationEnumValues:n,valuesByVariant:se,toggleAssetUploader:N,handleAssetsUploaderSelect:O,toggleAssetUploaderHandler:P,liquidInterpolationKeys:q,liquidInterpolations:x,localizationTrait:w,isWinner:t.winner,errors:_.get(K,["variants",a]),key:a,index:a,ABTestData:s,canBePreviewable:re&&ee},t)))}));var oe=_.reduce(G(),(function(e,t){return t.view_setups.forEach((function(t){return e.push(t.view_setup_id)})),e}),[]),le=classNames("link pvs",{"is-disabled":_.isEmpty(u)||_.isEmpty(oe)||!re,"is-pointable":!re}),ce=classNames("base-input",{"validation-error":K.name}),ue=classNames("designed-wrapper"),pe=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(a,!0).forEach((function(t){l(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},!re&&{"data-balloon":"Preview is not available"},{"data-balloon-pos":"right"});return e.createElement("div",{className:"designed-layout is-flex"},e.createElement("div",{className:ue},e.createElement("div",{className:"designed-layout-section",id:"ab-test-name"},e.createElement("h4",null,"A/B Test Name"),e.createElement("input",{type:"text",className:ce,value:p||"",onChange:v}),K.name&&e.createElement("div",{className:"form-validation"},e.createElement("span",null,K.name))),e.createElement("div",{className:"designed-layout-section"},e.createElement("h4",{className:"pbm"},"Content Under Test"),e.createElement("div",{className:"designed-layout-section-split"},e.createElement("div",{className:"base-form-label"},"View"),e.createElement("div",{className:"paragraph"},W)),e.createElement("div",{className:"designed-layout-section-split"},e.createElement("div",{className:"base-form-label"},"Content"),e.createElement("div",{className:"paragraph"},c.human_name)),e.createElement("div",{className:"designed-layout-section-split"},e.createElement("div",{className:"base-form-label"},"Conversion metric"),e.createElement("p",null,"This metric will be used as a final conversion metric in Funnel & Sales views on the A/B test report page. \u201cNew customers\u201d metric will also be calculated based on it. It is recommended to choose \u201cTalkable Dashboard Sales\u201d metric if you are uncertain."," ",e.createElement("a",{className:"link is-inherited",href:Routes.account_metrics_path(window.Site.account_id),target:"_blank"},"See all metrics"),"."),e.createElement(t.b,{className:"form-chosen-select",onChange:S,value:C,width:"100%"},_.values(window.ABTestMetrics).map((function(t){var a=r(t,2),n=a[0],s=a[1];return e.createElement("optgroup",{label:_.startCase(n).pluralize(),key:n},s.sort().map((function(t){var a=r(t,2),n=a[0],s=a[1];return e.createElement("option",{value:s,key:s},n)})))}))))),e.createElement("div",{className:"designed-layout-section",id:"ab-test-variants"},e.createElement("h4",null,"Specify Variants to Test"),e.createElement("p",null,"Specify at least two different variants you want to test within this A/B Test."),F&&e.createElement("div",{className:"Notice is-with-margin is-info"},"Please be aware that changing variants in the active A/B test will impact its results."),e.createElement("div",{className:"test-variants"},e.createElement("p",{className:"subtitle"},e.createElement("span",null,"Variant"),e.createElement("span",null,"Ratio")),R&&ie,!R&&e.createElement(Widget.LoaderVariants,null)),R&&e.createElement("div",{className:"test-variants-buttons"},!!ae.length&&!b&&e.createElement("a",{href:"#",className:"link pvs",onClick:m},e.createElement("i",{className:"icon icon-add-variant"}),"Add A/B test variant"),!!ae.length&&!Z["disabled_by_configuration?"]&&w===Widget.tabsConfig[0].className&&e.createElement(window.InfoSidebarProvider,{title:function(){return"Variables"},isFetched:R,data:x,render:function(t,a){return e.createElement("span",{className:"link pvs",onClick:t},e.createElement("i",{className:"link-icon"},e.createElement(n.UIIcon,{name:"bracers"})),"".concat(a?"Hide":"Show"," variables"))}}))),e.createElement(Widget.AbTestsCampaignFilter,{localeEntry:c,campaignsByLocaleKey:u,query:Q,statuses:z,groupedCampaigns:te,onQuerySearch:this.props.onQuerySearch,onStatusChange:H,toggleAllCampaigns:V,collapseStatusesChange:this.collapseStatusesChange,allCampaignsSelected:I,toggleCampaign:k,collapseStatuses:this.state.collapseStatuses,updateAllCampaignsStatus:this.props.updateAllCampaignsStatus,errors:K,viewNames:$,mode:j}),!_.isEmpty(u)&&e.createElement("div",{className:"designed-layout-footer is-gray"},e.createElement("div",{className:"designed-layout-footer-grid"},e.createElement("a",o({href:"#",className:le,onClick:this.togglePreview,"data-close":!0},pe),e.createElement(n.UIIcon,{name:"eye"}),e.createElement("span",null,"Preview A/B Test")),j&&e.createElement("a",{className:"link pas mhl",href:Routes.site_split_test_path(Site,window.ABTestDataId)},e.createElement(n.UIIcon,{name:"table"}),e.createElement("span",null,"View Report"))),e.createElement("div",{className:"designed-layout-footer-grid"},j&&e.createElement("div",{className:"link pas is-negative",onClick:D},e.createElement(n.UIIcon,{name:"bin"}),e.createElement("span",null,"Delete")),e.createElement("a",{className:"link pas mhl",href:M},"Cancel"),e.createElement("button",{type:"button",className:"base-btn is-success is-big",onClick:B,disabled:L},"Save A/B Test"))),X&&e.createElement(Widget.AbTestPreviewContainer,{abTestName:p,abTestVariants:ae,allCampaigns:U,onClose:J,viewSetupIds:oe,campaignsByLocaleKey:u,abTestId:s.id,localizationKey:c.key,abTestVariantChosen:Y,handleShowAbTestPreviewVariant:d})))}}])&&c(d.prototype,f),h&&c(d,h),s}(e.Component),Widget.AbTestsContent.defaultProps={abTestVariants:[]}}).call(this,a("q1tI"))},"6qVb":function(e,t,a){(function(e){function t(e){return(t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,a){return!a||"object"!==t(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsSplitTestsEntries=function(t){function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=s(this,r(o).call(this,e))).getParams=function(){for(var e={},t=window.location.search.substr(1).split("&"),a=0;a<t.length;a++){var n=t[a].split("=");e[n[0]]=n[1]}return e},t.updateCampaignsByLocaleKey=function(e){t.setState({campaignsByLocaleKey:e})},t.updateAbTestData=function(e){t.setState({ABTestData:e})},t.fetchCampaignsByLocaleKey=function(e){e&&$.get(Routes.campaigns_by_locale_key_internal_site_localization_split_tests_path(Site,{locale_key:e}),(function(e){t.setState({campaignsByLocaleKeyFetched:!0,campaignsByLocaleKey:t.formatCampaignsByLocaleKey(e.result.campaigns)}),t.fetchABTestData(t.state.queryParams.split_test_id)}))},t.fetchCampaigns=function(){$.get(Routes.internal_site_campaigns_path(Site),{no_spinner:!0}).success((function(e){t.setState({campaignsFetched:!0,campaigns:_.sortBy(_.get(e,"result.campaigns",[]),(function(e){return Constants.CAMPAIGN_STATUSES_ORDER[e.status]}))})}))},t.matchesSplitTestId=function(e){if(!e)return!1;var a=t.state.queryParams.split_test_id;return _.includes([window.ABTestDataId,+a],e)},t.state={ABTestData:window.ABTestData||{},campaignsByLocaleKeyFetched:!1,campaigns:[],campaignsFetched:!1,campaignsByLocaleKey:{},queryParams:t.getParams(),localeEntry:LocaleEntry||{},sourceABTestData:{}},t}var l,c,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,t),l=o,(c=[{key:"componentDidMount",value:function(){var e=this.state,t=e.ABTestData,a=e.localeEntry;this.fetchCampaigns();var n=t.locale_key||a.key;this.fetchCampaignsByLocaleKey(n)}},{key:"fetchABTestData",value:function(e){var t=this;e&&$.get(Routes.internal_site_localization_split_test_path(Site,e),{no_spinner:!0}).success((function(e){return t.setState({sourceABTestData:t.formatAbTestData(e.result.split_test)},t.attachCampaigns)}))}},{key:"formatAbTestData",value:function(e){return _.pick(e,["key","name","variants","campaigns","locale_key","view_setup_ids","winner_variant"])}},{key:"formatCampaignsByLocaleKey",value:function(e){var t=this;if(e){var a=this.state.queryParams,n=a.campaign_id,s=a.split_test_id;return _.transform(e,(function(e,a,r){a.attached=t.matchesSplitTestId(a.split_test_id),r!==n||s||(a.attached=!0),e[r]=a}),{})}}},{key:"attachCampaigns",value:function(){var e=this;this.setState({campaignsByLocaleKey:_.transform(this.state.campaignsByLocaleKey,(function(t,a,n){var s=a.split_test_id,r=_.find(e.state.sourceABTestData.campaigns,{id:+n});a.attached=!!r&&e.matchesSplitTestId(s),t[n]=a}),{})})}},{key:"render",value:function(){return e.createElement("div",null,e.createElement(Widget.AbTestsLayout,a({updateCampaignsByLocaleKey:this.updateCampaignsByLocaleKey,updateAbTestData:this.updateAbTestData,matchesSplitTestId:this.matchesSplitTestId},this.props,this.state)))}}])&&n(l.prototype,c),u&&n(l,u),o}(e.Component)}).call(this,a("q1tI"))},"9N65":function(e,t,a){(function(e){function t(e){return(t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,a){return!a||"object"!==t(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsLayout=function(t){function c(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(t=i(this,o(c).call(this,e))).updateViewSetupData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props,a=e.campaignsByLocaleKey,n=e.localeEntry.campaign_id,r=e.queryParams,i=t.takeAttachedLocales(a),o=a[r.campaign_id||n],l=_.isEmpty(i)?s({},n,o):i,c=_.union(_.flatMap(l,(function(e){return _.map(e.view_setups,"human_name")})));t.setState({viewSetupId:_.get(o,"view_setups[0].view_setup_id",null),viewSetup:_.get(o,"view_setups[0]",{}),viewSetupLabel:c.join(", "),viewNames:c})},t.onQuerySearch=function(e){t.setState({query:e.target.value.toLowerCase()})},t.applyCampaignFilter=function(e){e.preventDefault();var a=_.trim(e.target.innerText),r=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(a,!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},t.state.statuses);r[a]=!t.state.statuses[a],t.setState({statuses:r})},t.formAbTestVariants=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props.ABTestData,a=t.props.localeEntry,n=[];if(e.variants)n=[].concat(e.variants);else{var s=a.value||a.default,r=_.find(a.enum_values,(function(e){return e!==s}))||"";n=[s,r].map((function(e){return{distribution_rate:1,preview:null,value:e}}))}return t.setState({addVariantDisabled:t.shouldAddVariantDisable(n),deleteVariantDisabled:t.shouldDeleteVariantDisable(n)}),n},t.changeNameHandler=function(e){t.setState({abTestName:e.target.value})},t.changeConversionMetric=function(e){t.setState({abTestMetricId:e.target.value})},t.shouldAddVariantDisable=function(e){var a=t.props.localeEntry.enum_values,n=_.filter(e,(function(e){return!e.deleted})),s=n.length>=UI.AB_TEST_VARIANTS_LIMIT,r=!_.isEmpty(a)&&a.length<=n.length;return s||r},t.shouldDeleteVariantDisable=function(e){return _.filter(e,(function(e){return!e.deleted})).length<3},t.shouldWarnAboutVariantChange=function(){return!!_.get(t.props,"ABTestData.last_impression_created_at")},t.handleAddVariant=function(e){e.preventDefault();var a=t.props.localeEntry.enum_values,n=[].concat(t.state.abTestVariants);n.push({distribution_rate:1,preview:null,value:_.find(a,(function(e){return!_.includes(n.map((function(e){return e.value})),e)}))||""}),t.setState({abTestVariantChangedWithImpression:t.shouldWarnAboutVariantChange(),addVariantDisabled:t.shouldAddVariantDisable(n),deleteVariantDisabled:t.shouldDeleteVariantDisable(n),abTestVariants:n})},t.handleShowAbTestPreviewVariant=function(e){var a=t.state.abTestVariants,n=e-_(a).map("deleted").slice(0,e).compact().value().length;t.setState({abTestVariantChosen:n,previewMode:!0})},t.handleRemoveVariant=function(e){var a=[].concat(t.state.abTestVariants);a[e]._destroy=!0,a[e].deleted=!0,a[e].value=null,a[e].distribution_rate=0,delete a[e].preview,t.setState({abTestVariantChangedWithImpression:t.shouldWarnAboutVariantChange(),addVariantDisabled:t.shouldAddVariantDisable(a),deleteVariantDisabled:t.shouldDeleteVariantDisable(a),abTestVariants:a})},t.handleChangeRatio=function(e,a){var n=[].concat(t.state.abTestVariants),s=+a.target.value;n[e].distribution_rate=_.isNumber(s)&&s>0?s:1,t.setState({abTestVariantChangedWithImpression:t.shouldWarnAboutVariantChange(),abTestVariants:n})},t.handleChangeMessage=function(e,a,n){var s=[].concat(t.state.abTestVariants);s[e].value=a,s[e].preview=n,t.setState({abTestVariantChangedWithImpression:t.shouldWarnAboutVariantChange(),abTestVariants:s})},t.togglePreview=function(e){(_.isBoolean(e)||_.get(e,"currentTarget.dataset.close"))&&(_.isObject(e)&&e.preventDefault(),t.setState({previewMode:!t.state.previewMode,abTestVariantChosen:0}))},t.toggleAssetUploaderHandler=function(){t.setState({assetUploader:!1})},t.toggleAssetUploader=function(e){t.setState({assetUploader:e})},t.handleAssetsUploaderSelect=function(e,a,n){e&&(t.toggleAssetUploader(),t.handleChangeMessage(n,a.name,a.url))},t.abTestDeleteModal=function(){var e=_.merge({},t.props.ABTestData);_.isEmpty(t.state.usedCampaigns)||(e.campaigns=t.state.campaigns.filter((function(e){return _.includes(t.state.usedCampaigns,+e.id)}))),t.setState({modal:t.state.modal?null:{template:"confirmDeletePopup",closeAbPopup:t.abTestDeleteModal,footerButtonFunc:t.abTestDelete,data:e}})},t.abTestDelete=function(){$.ajax({url:Routes.internal_site_split_test_path(Site,window.ABTestDataId),type:"DELETE",dataType:"json",data:{no_spinner:!0},success:function(){window.location.replace(Routes.site_split_tests_path(Site))},error:function(e){console.log("not delete",e)}})},t.prepareVariantsForTransfer=function(){return _.reduce(t.state.abTestVariants,(function(e,a){if(a.id||!a.deleted){var n=["value","_destroy","distribution_rate"];t.props.mode&&n.push("id"),e.push(_.pick(a,n))}return e}),[])},t.prepareLocalesForTransfer=function(){return _.reduce(t.takeAttachedLocales(),(function(e,t){return e[t.locale_entry_id]=!0,e}),{})},t.abTestSaveChanges=function(){var e=t.props.mode,a=Routes.internal_site_localization_split_tests_path(Site);e&&(a=Routes.internal_site_localization_split_test_path(Site,window.ABTestDataId)),t.setState({saveAbTestChangesDisabled:!0}),$.ajax({url:a,type:e?"PATCH":"POST",dataType:"json",data:{locale_key:t.props.localeEntry.key,split_test:{name:_.trim(t.state.abTestName),metric_id:t.state.abTestMetricId,variants_attributes:t.prepareVariantsForTransfer()},attached_locale_entries:t.prepareLocalesForTransfer(),original_locale_id:t.props.localeEntry.id},complete:t.onAbTestSaveComplete,success:t.onAbTestSaveSucceed,error:t.onAbTestSaveFail})},t.onAbTestSaveComplete=function(){t.setState({saveAbTestChangesDisabled:!1})},t.onAbTestSaveSucceed=function(e){var a=e.result;t.props.updateAbTestData(a),t.setState({errors:{}});var n=decodeURIComponent(t.props.queryParams.referrer||""),s=n?{referrer:n}:{};n?window.location=n:t.props.mode?Validation.showSuccessFlash("Changes have been saved",8e3):window.location=Routes.edit_site_localization_split_test_path(Site,a.id,s)},t.onAbTestSaveFail=function(e){var a=_.get(e,"responseJSON.result.errors",{});t.setState({errors:a},t.scrollToId)},t.scrollToId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.state.errors,a="#";e.name?a+="ab-test-name":e.variants?a+="ab-test-variants":a+="ab-test-campaigns",setTimeout((function(){$("html, body").animate({scrollTop:$(a).offset().top},500)}),100)},t.toggleCampaign=function(e){var a=e.id;t.props.updateCampaignsByLocaleKey(t.transformCampaignsByLocaleKey([a]))},t.toggleAllCampaigns=function(e){t.props.updateCampaignsByLocaleKey(t.transformCampaignsByLocaleKey(e,!0))},t.updateAllCampaignsStatus=function(e,a){t.setState({allCampaignsSelected:!!e&&!a})},t.takeAttachedLocales=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props.campaignsByLocaleKey;return _.reduce(e,(function(t,a,n){return a.attached&&(t[n]=e[n]),t}),{})},t.state={abTestName:"",abTestMetricId:window.abTestMetricId,abTestVariants:[],addVariantDisabled:!1,deleteVariantDisabled:!0,viewSetupLabel:"",viewSetupId:null,viewSetup:{},localizationName:"",localizationTrait:"text",localizationEnumValues:null,assetUploader:!1,abTestVariantChangedWithImpression:!1,allCampaignsSelected:!1,saveAbTestChangesDisabled:!1,liquidInterpolationKeys:[],liquidInterpolations:[],liquidInterpolationsFetched:!1,errors:{},modal:null,usedCampaigns:[],query:null,viewNames:[],statuses:{Live:!0,Scheduled:!0,Test:!0,Disabled:!0},abTestVariantChosen:0,previewMode:!1},t}var u,p,m;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(c,t),u=c,(p=[{key:"componentDidMount",value:function(){var e=this.props,t=e.localeEntry,a=e.ABTestData,n=e.mode;if(!_.isEmpty(t)){var s=n?a.name:"".concat(t.human_name," - ").concat(moment().format("MM/DD/YYYY")),r=_.find(Widget.tabsConfig,(function(e){return e.rules(t)}));this.setState({localizationTrait:r.className||this.state.localizationTrait,localizationEnumValues:t.enum_values,localizationName:t.human_name,abTestName:s})}}},{key:"shouldComponentUpdate",value:function(e){return e.campaignsFetched&&e.campaignsByLocaleKeyFetched}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.campaignsByLocaleKeyFetched!==this.props.campaignsByLocaleKeyFetched&&this.setState({abTestVariants:this.formAbTestVariants()},this.fetchAvailableVariablesData),this.props.ABTestData.variants&&e.ABTestData.variants.length!==this.props.ABTestData.variants.length&&this.setState({abTestVariants:this.formAbTestVariants(e.ABTestData)}),_.isEqual(e.sourceABTestData,this.props.sourceABTestData)||this.setState({abTestVariants:this.formAbTestVariants(e.sourceABTestData)}),_.isEmpty(e.campaignsByLocaleKey)||this.updateViewSetupData(e)}},{key:"fetchAvailableVariablesData",value:function(){var e=this,t=this.state,a=t.viewSetupId,n=t.viewSetup,s=this.props,r=s.localeEntry,i=s.queryParams.campaign_id||r.campaign_id;return a?n["disabled_by_configuration?"]?(this.setState({liquidInterpolationsFetched:!0}),!1):void $.ajax({url:Routes.available_variables_internal_site_campaign_view_setup_path(Site,i,a),type:"GET",dataType:"json",data:{no_spinner:!0},complete:function(){e.setState({liquidInterpolationsFetched:!0})},success:function(t){e.setState({liquidInterpolations:t.result.variables}),e.formatInterpolationKeys(t.result.variables)}}):this.setState({liquidInterpolationsFetched:!0})}},{key:"formatInterpolationKeys",value:function(e){var t=this,a={},n={};_.map(e,(function(e,t){e.description&&(a[t]=e.value)})),fetchKeyRecursively=function(e){function t(t,a){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,a){_.isObject(e)&&_.keys(e).forEach((function(s){delete n[s];var r=a?"".concat(a,".").concat(s):s;_.isObject(t.getObjectPropertyByPath(e,s))?fetchKeyRecursively(t.getObjectPropertyByPath(e,s),r):n[r]=r}))})),fetchKeyRecursively(a),this.setState({liquidInterpolationKeys:_.keys(n)})}},{key:"getObjectPropertyByPath",value:function(e,t){if("string"!==typeof t||"undefined"===typeof e)return null;var a=t.indexOf(".");if(a>-1){var n=e[t.substring(0,a)];if(n)return this.getObjectPropertyByPath(n,t.substr(a+1))}return e[t]}},{key:"transformCampaignsByLocaleKey",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _.transform(this.props.campaignsByLocaleKey,(function(n,s,r){_.includes(t,+r)&&(s.attached=a?!e.state.allCampaignsSelected:!s.attached),n[r]=s}),{})}},{key:"render",value:function(){var t=this.props,n=t.localeEntry,s=t.ABTestData,r=t.campaigns,i=t.campaignsByLocaleKey,o=t.queryParams,l=t.campaignsFetched,c=t.campaignsByLocaleKeyFetched,u=t.mode,p=t.sourceABTestData,m=l&&c,d=Routes.site_split_tests_path(Site);return o.referrer?d=decodeURIComponent(o.referrer):s.id&&(d=Routes.site_split_test_path(Site,s.id)),e.createElement("div",{className:"ab-tests-layout"},e.createElement(Widget.AbTestsLayoutTopMenu,{referrerUrl:d}),e.createElement("div",{className:"ab-tests-layout-content"},e.createElement("div",{className:"App-container-inner"},e.createElement("div",{className:"designed-layout-head"},e.createElement("h1",null,u?"Edit ":"Create a New ","Content A/B Test"),e.createElement("a",{className:"base-btn is-transparent-action is-smaller hidden",href:"#",target:"_blank"},"Learn More")),!!r.length&&!_.isEmpty(n)&&e.createElement(Widget.AbTestsContent,a({localeEntry:n,changeNameHandler:this.changeNameHandler,changeConversionMetric:this.changeConversionMetric,handleAddVariant:this.handleAddVariant,handleShowAbTestPreviewVariant:this.handleShowAbTestPreviewVariant,handleRemoveVariant:this.handleRemoveVariant,handleChangeMessage:this.handleChangeMessage,handleChangeRatio:this.handleChangeRatio,toggleAssetUploader:this.toggleAssetUploader,handleAssetsUploaderSelect:this.handleAssetsUploaderSelect,toggleAssetUploaderHandler:this.toggleAssetUploaderHandler,toggleCampaign:this.toggleCampaign,togglePreview:this.togglePreview,toggleAllCampaigns:this.toggleAllCampaigns,abTestSaveChanges:this.abTestSaveChanges,abTestDeleteModal:this.abTestDeleteModal,applyCampaignFilter:this.applyCampaignFilter,onQuerySearch:this.onQuerySearch,takeAttachedLocales:this.takeAttachedLocales,updateAllCampaignsStatus:this.updateAllCampaignsStatus,matchesSplitTestId:this.props.matchesSplitTestId,referrerUrl:d,campaigns:r,campaignsByLocaleKey:i,mode:u,ABTestData:s,queryParams:o,sourceABTestData:p},this.state)),m&&!r.length||_.isEmpty(n)&&e.createElement(Widget.AbTestsContentEmpty,null))),this.state.modal&&e.createElement(Widget.AbTestsModal,this.state.modal))}}])&&r(u.prototype,p),m&&r(u,m),c}(e.Component)}).call(this,a("q1tI"))},HqGH:function(e,t,a){(function(e){Widget.templateLoaderVariant=function(){return e.createElement("div",{className:"test-variants-row"},e.createElement("div",{className:"test-variants-row-msg-box"},e.createElement("div",{className:"abtest-char"}),e.createElement("div",{className:"test-variants-row-position"}),e.createElement("div",{className:"base-textarea"})),e.createElement("div",{className:"test-variants-row-action-box"},e.createElement("input",{type:"number",className:"test-variants-row-ratio"}),e.createElement("span",{className:"test-variants-row-percentage"}),e.createElement("button",{type:"button",className:"test-variants-serv-btn"})))},Widget.LoaderVariants=function(){return e.createElement("div",{className:"loader is-ab-test-variants"},[1,2].map((function(t){return e.createElement(Widget.templateLoaderVariant,{key:t})})),e.createElement("div",{className:"loader-box"},"Loading",e.createElement("div",{className:"loader-box-spinner"},e.createElement("div",{className:"loader-box-spinner-bounce"}))))}}).call(this,a("q1tI"))},NCBp:function(e,t,a){(function(e){function t(e){return(t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,a){return!a||"object"!==t(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsCampaignFilterBlock=function(t){function i(t){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(a=n(this,s(i).call(this,t))).createNotice=function(t){var n=a.props.campaignsByLocaleKey[t.id],s=window.LocaleEntry,r=s.enum_values.sort(),i="";if(n)if(n.split_test_id&&window.ABTestDataId!==n.split_test_id){var o=Routes.site_split_test_path(Site,n.split_test_id),l=e.createElement("a",{key:"link",href:o,target:"_blank"},"A/B test #",n.split_test_id);i=e.createElement("span",null,"- Used in ",l)}else n.trait===s.trait&&_.isEqual(n.enum_values.sort(),r)||(i=e.createElement("span",null,"- Does not have this exact content"));else i=a.defaultNotice;return i},a.toggleSpoiler=function(){if(a.state[a.props.name].togglable){var e=a.state[a.props.name];e.open=!e.open,a.setState(e)}},a.state={attached:{title:"Selected Campaigns",disabled:!1,togglable:!1,open:!0},eligible:{title:"Available Campaigns",disabled:!1,togglable:!0,open:!0},ineligible:{title:"Ineligible Campaigns",disabled:!0,togglable:!0,open:!1},MAX_COUNT:999,INITIAL_COUNT:5},a.defaultNotice="- Content is inactive or does not exist",a.collapseStatusesChange=t.collapseStatusesChange.bind(null,"".concat(t.name,"Expanded")),a}var o,l,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(i,t),o=i,(l=[{key:"render",value:function(){var t=this,a=this.props,n=a.campaignsByLocaleKey,s=a.toggleCampaign,r=a.data,i=a.collapseStatus,o=a.name,l=a.zerocase,c=this.state,u=c.MAX_COUNT,p=c.INITIAL_COUNT,m=r.map((function(a){var r=t.createNotice(a),i=n[a.id],l=!t.state[o].disabled&&_.get(i,"attached"),c=_.map(_.get(i,"view_setups",[]),(function(e){return e.human_name})).join(", ");return e.createElement(Widget.CampaignFilterCampaign,{site:Site,viewSetupLabel:c,campaign:a,notice:r,abbreviation:!0,is_edit:!0,disabled:t.state[o].disabled,checked:l,onStatusChange:s,key:a.id})})),d=i?u:p,f=m.length?m.slice(0,d):l,h=classNames("campaignfilter-spoiler",{"is-readonly":!this.state[o].togglable||!m.length,"is-open":this.state[o].open||!m.length});return e.createElement("li",null,e.createElement("h4",{className:h},e.createElement("span",{className:"campaignfilter-spoiler-link",onClick:this.toggleSpoiler},this.state[o].title)),(this.state[o].open||_.isEmpty(m))&&e.createElement("ul",null,f,m.length>p&&e.createElement("li",{className:"is-more"},e.createElement("div",{className:"base-btn is-small is-action is-block",onClick:this.collapseStatusesChange},i?"Collapse campaigns":"Show all campaigns"))))}}])&&a(o.prototype,l),c&&a(o,c),i}(e.Component)}).call(this,a("q1tI"))},SDmI:function(e,t,a){"use strict";(function(e){var t=a("GaHK");function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsLayoutTopMenu=function(a){function n(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);for(var a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];return(t=r(this,(e=i(n)).call.apply(e,[this].concat(s)))).getReferrerName=function(e){var t="Dashboard";return _.includes(e,"campaigns")&&(t="Campaign A/B tests"),_.includes(e,"editor")&&(t="Editor"),_.includes(e,"split_tests")&&(t="All A/B tests"),_.includes(e,"split_tests/")&&(t="A/B Test Report"),_.includes(e,"reports")&&(t="Report"),t},t}var l,c,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(n,a),l=n,(c=[{key:"render",value:function(){var a=this.props.referrerUrl;return e.createElement("div",{className:"App-navbar"},e.createElement("div",{className:"App-container-inner App-navbar-grid"},e.createElement("div",{className:"App-navbar-box"},e.createElement("a",{href:a,className:"App-navbar-links"},e.createElement(t.UIIcon,{name:"leftArrow",className:"is-small-arrow-left"}),e.createElement("span",{className:"inline"},"Back to ",this.getReferrerName(a)))),e.createElement("div",{className:"App-navbar-box"},e.createElement("a",{href:Routes.site_split_tests_path(Site),className:"App-navbar-links"},"Show All A/B Tests"))))}}])&&s(l.prototype,c),u&&s(l,u),n}(e.Component)}).call(this,a("q1tI"))},Usgi:function(e,t,a){"use strict";a.r(t);a("HEme"),a("gI23"),a("7OGs"),a("M85t"),a("F9bE"),a("GKah"),a("6qVb"),a("HqGH"),a("lGm9"),a("9N65"),a("SDmI"),a("6OeU"),a("o0ch"),a("/0Qq"),a("yTUo"),a("NCBp")},lGm9:function(e,t,a){(function(e){Widget.LoaderCampaigns=function(){return e.createElement("div",{className:"loader is-campaigns"},e.createElement("div",{className:"loader-static-block"}),e.createElement("div",{className:"campaignfilter-head is-th"},e.createElement("div",{className:"campaignfilter-campaign-check"},e.createElement("div",{className:"base-checkbox"},e.createElement("input",{type:"checkbox"}),e.createElement("label",{htmlFor:"select-all-campaigns"},"\xa0"))),e.createElement("div",{className:"campaignfilter-campaign-data"},"Campaign name"),e.createElement("div",{className:"campaignfilter-campaign-offers"},"Offers total:")),e.createElement("ul",{className:"campaignfilter-list"},e.createElement("li",null,e.createElement("ul",null,e.createElement("li",{className:"is-edit"},e.createElement("div",{className:"campaignfilter-campaign-check"},e.createElement("div",{className:"base-checkbox"},e.createElement("input",{type:"checkbox"}),e.createElement("label",null,"\xa0"))),e.createElement("div",{className:"campaignfilter-campaign-status is-test"},e.createElement("i",null)),e.createElement("div",{className:"campaignfilter-campaign-data"},e.createElement("a",{href:"#"}),e.createElement("div",{className:"campaignfilter-campaign-id"})),e.createElement("div",{className:"campaignfilter-campaign-offers"},e.createElement("span",null))),e.createElement("li",{className:"is-edit"},e.createElement("div",{className:"campaignfilter-campaign-check"},e.createElement("div",{className:"base-checkbox"},e.createElement("input",{type:"checkbox"}),e.createElement("label",null,"\xa0"))),e.createElement("div",{className:"campaignfilter-campaign-status is-test"},e.createElement("i",null)),e.createElement("div",{className:"campaignfilter-campaign-data"},e.createElement("a",{href:"#"}),e.createElement("div",{className:"campaignfilter-campaign-id"})),e.createElement("div",{className:"campaignfilter-campaign-offers"},e.createElement("span",null))),e.createElement("li",{className:"is-edit"},e.createElement("div",{className:"campaignfilter-campaign-check"},e.createElement("div",{className:"base-checkbox"},e.createElement("input",{type:"checkbox"}),e.createElement("label",null,"\xa0"))),e.createElement("div",{className:"campaignfilter-campaign-status is-test"},e.createElement("i",null)),e.createElement("div",{className:"campaignfilter-campaign-data"},e.createElement("a",{href:"#"}),e.createElement("div",{className:"campaignfilter-campaign-id"})),e.createElement("div",{className:"campaignfilter-campaign-offers"},e.createElement("span",null)))))),e.createElement("div",{className:"loader-box"},"Loading",e.createElement("div",{className:"loader-box-spinner"},e.createElement("div",{className:"loader-box-spinner-bounce"}))))}}).call(this,a("q1tI"))},o0ch:function(e,t,a){"use strict";(function(e){var t=a("fRW6"),n=a("GaHK");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsContentRow=function(a){function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=c(this,u(s).call(this,e))).handleShowAbTestPreviewVariant=function(e){t.props.canBePreviewable&&t.props.handleShowAbTestPreviewVariant(t.props.index,e)},t.onValueChange=function(e){t.props.handleChangeMessage(t.props.index,e.target.value)},t.onCopyChange=function(e){t.props.handleChangeMessage(t.props.index,e[t.props.index].values[0])},t.fetchPreview=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.props,a=e.value,n=e.localeEntry,s=a||n.value||n.default;s&&_.includes(["share_image","asset"],n.trait)&&$.get(Routes.show_internal_site_static_assets_path(Site,{name:s})).success((function(e){t.setState({asset:e.result.static_asset})}))},t.formEnumOptions=function(){var e=t.props,a=e.valuesByVariant;return e.localizationEnumValues.map((function(e,n){return{label:e,disabled:_.includes(_.values(a),e)&&e!==t.props.value,value:e}}))},t.state={asset:{}},t.handleRemoveVariant=e.handleRemoveVariant.bind(null,e.index),t.handleChangeRatio=e.handleChangeRatio.bind(null,e.index),t.toggleAssetUploader=e.toggleAssetUploader.bind(null,e.index),t}var m,d,f;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(s,a),m=s,(d=[{key:"componentDidMount",value:function(){this.fetchPreview()}},{key:"componentDidUpdate",value:function(){this.fetchPreview(this.props)}},{key:"shouldComponentUpdate",value:function(e,t){return e.percentage!==this.props.percentage||e.value!==this.props.value||!_.isEqual(e.assetUploader,this.props.assetUploader)||!_.isEqual(e.errors,this.props.errors)||!_.isEqual(t.asset,this.state.asset)||e.canBePreviewable!==this.props.canBePreviewable}},{key:"render",value:function(){var a,s=this.props,l=s.ABTestData,c=s.localeEntry,u=s.position,p=s.percentage,m=s.distribution_rate,d=s.deleteVariantDisabled,f=s.localizationTrait,h=s.value,g=void 0===h?"":h,b=s.index,y=s.assetUploader,v=s.handleAssetsUploaderSelect,E=s.toggleAssetUploaderHandler,w=s.liquidInterpolationKeys,S=s.liquidInterpolations,C=s.errors,T=s.isWinner,A=s.deleted,N=_.reduce(C,(function(e,t,a){return _.includes(["value","value_hash"],a)&&e.push(t.join(", ")),e}),[]),O=this.props.preview||this.state.asset.url,P=this.state.asset.size&&this.state.asset.size.filesize(),B=!!this.state.asset.size,D="".concat(this.state.asset.width," x ").concat(this.state.asset.height," px"),j=this.state.asset.width&&this.state.asset.height,k=this.formEnumOptions(),V=classNames("test-variants-row",(o(a={},"is-".concat(f),f),o(a,"is-error",!_.isEmpty(N)),o(a,"hidden",A),a)),I=classNames("abtest-char",{"is-winner":T,"is-loser":"finished"===l.status&&!T}),L=classNames({"test-variants-row-img-box":f===Widget.tabsConfig[1].className,"form-chosen-select":f===Widget.tabsConfig[3].className,"validation-error":!_.isEmpty(N)}),U=g?{value:g,preview:O}:{},q=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(a,!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},!this.props.canBePreviewable&&{"data-balloon":"Preview is not available"},{"data-balloon-pos":"left"});return e.createElement("div",{className:V},e.createElement("div",{className:"test-variants-row-container"},e.createElement("div",{className:"test-variants-row-msg-box"},e.createElement("div",{className:I},u),f===Widget.tabsConfig[0].className&&e.createElement(window.Components.AutocompleteField,{text:g,dataId:b,class:L,placeholder:"Enter text here",onLocalizationItemABChange:this.onCopyChange,liquidInterpolationKeys:w,liquidInterpolations:S,key:b}),f===Widget.tabsConfig[2].className&&e.createElement(n.UIColorPicker,{name:"color",value:g,onChange:this.onValueChange}),f===Widget.tabsConfig[3].className&&e.createElement(t.b,{className:L,onChange:this.onValueChange,options:k,width:"100%",value:g,key:b}),f===Widget.tabsConfig[1].className&&g&&(!y||0!==y)&&e.createElement("div",null,e.createElement("div",{className:L},e.createElement("img",{src:O,onClick:this.toggleAssetUploader}),e.createElement("div",{className:"Abtest-variant-tip"},e.createElement("div",{className:"mbm"},g),(B||j)&&e.createElement("div",{className:"Abtest-variant-tip-icon-data"},"Original asset:\xa0",P,", ",D)))),f===Widget.tabsConfig[1].className&&!g&&(!y||0!==y)&&e.createElement("div",{className:L},e.createElement("div",{className:"base-btn is-success is-small",onClick:this.toggleAssetUploader},e.createElement("i",{className:"icon icon-upload"}),e.createElement("span",null,"Select image"))),f===Widget.tabsConfig[1].className&&y===b&&e.createElement(window.LocaleAssetsUploader,{localization:{localization_id:c.id},selected:U,selectedLocalizationAssetData:this.state.asset,onSelect:v,onClose:E,extraData:b})),e.createElement("div",{className:"test-variants-row-action-box"},e.createElement("input",{type:"number",className:"test-variants-row-ratio",value:m,onChange:this.handleChangeRatio}),e.createElement("span",{className:"test-variants-row-percentage"},p),e.createElement("button",r({type:"button",className:"test-variants-row-serv-btn",disabled:!this.props.canBePreviewable,onClick:this.handleShowAbTestPreviewVariant},q),e.createElement(n.UIIcon,{name:"eyeGray",position:"center",width:"24",height:"24",className:"is-base-colored"})),e.createElement("button",{type:"button",className:"test-variants-row-serv-btn",onClick:this.handleRemoveVariant,disabled:d},e.createElement(n.UIIcon,{name:"bin",position:"center"})))),!_.isEmpty(N)&&e.createElement("div",{className:"form-validation"},N))}}])&&l(m.prototype,d),f&&l(m,f),s}(e.Component)}).call(this,a("q1tI"))},yTUo:function(e,t,a){(function(e){function t(e){return(t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,a){return!a||"object"!==t(a)&&"function"!==typeof a?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):a}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}Widget.AbTestsCampaignFilter=function(t){function o(){var e,t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(t=s(this,(e=r(o)).call.apply(e,[this].concat(n)))).toggleAllCampaigns=function(){var e=t.props.groupedCampaigns,a=e.eligible,n=e.attached,s=a.map((function(e){return e.id})).concat(n.map((function(e){return e.id})));t.props.toggleAllCampaigns(s)},t}var l,c,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(o,t),l=o,(c=[{key:"componentDidUpdate",value:function(e){var t=this.props.groupedCampaigns,a=t.eligible,n=t.attached;a.length===e.groupedCampaigns.eligible.length&&n.length===e.groupedCampaigns.attached.length||this.props.updateAllCampaignsStatus(n.length,a.length)}},{key:"shouldComponentUpdate",value:function(e){return e.allCampaignsSelected!==this.props.allCampaignsSelected||e.query!==this.props.query||!_.isEqual(e.campaignsByLocaleKey,this.props.campaignsByLocaleKey)||!_.isEqual(e.collapseStatuses,this.props.collapseStatuses)||!_.isEqual(e.groupedCampaigns,this.props.groupedCampaigns)||!_.isEqual(e.statuses,this.props.statuses)}},{key:"render",value:function(){var t=this,n=this.props,s=n.groupedCampaigns,r=n.localeEntry,i=n.campaignsByLocaleKey,o=n.query,l=n.statuses,c=n.onQuerySearch,u=n.onStatusChange,p=n.allCampaignsSelected,m=n.collapseStatuses,d=n.viewNames,f=e.createElement("li",null,e.createElement("p",{className:"campaignfilter-zerocase"},"No campaigns found")),h=_.reduce(s,(function(n,s,r){return n.push(e.createElement(Widget.AbTestsCampaignFilterBlock,a({data:s,collapseStatus:m["".concat(r,"Expanded")],name:r,key:r,zerocase:f},t.props))),n}),[]),g=classNames("Notice is-with-margin is-info",{hidden:!_.isEmpty(s.attached)||o});return e.createElement("div",{className:"designed-layout-section",id:"ab-test-campaigns"},e.createElement("h4",null,"Select Campaigns in which this A/B Test should run"),e.createElement("p",null,"Selected Campaigns should have \u201d",r.human_name,"\u201d on their"," ","view".pluralize(d.length),d.length>1?":":""," ",d.join(", ")," and should NOT have another A/B Test already running for the same content."),e.createElement("div",null,e.createElement(Widget.CampaignFilterSearch,{query:o,statuses:l,onQuerySearch:c,onStatusChange:u}),e.createElement("div",{className:g},"The A/B test should have at least one selected Campaign in order to keep working."),!_.isEmpty(i)&&e.createElement("div",null,e.createElement(Widget.CampaignFilterHead,{toggle:this.toggleAllCampaigns,all_campaigns_selected:p}),e.createElement("ul",{className:"campaignfilter-list"},h)),_.isEmpty(i)&&e.createElement(Widget.LoaderCampaigns,null)))}}])&&n(l.prototype,c),u&&n(l,u),o}(e.Component)}).call(this,a("q1tI"))}},[["Usgi",0,1]]]);